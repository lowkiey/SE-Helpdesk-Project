<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Socket.IO Chat</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.18.0/font/bootstrap-icons.css">
  <style>
    body {
      margin: 0;
      padding-bottom: 3rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #000;
      color: #fff;
      background-image: url('https://source.unsplash.com/1920x1080/?black-background');
      background-size: cover;
    }

    #form {
      background: rgba(0, 0, 0, 0.15);
      padding: 1rem;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      box-sizing: border-box;
      backdrop-filter: blur(10px);
    }

    #input {
      border: none;
      padding: 0.5rem;
      flex-grow: 1;
      border-radius: 5px;
      margin-right: 0.5rem;
    }

    #input:focus {
      outline: none;
    }

    #form > button {
      background: #007bff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      outline: none;
      color: #fff;
      cursor: pointer;
    }

    #toggle-btn {
      background: #dc3545;
      margin-left: 0.5rem;
    }

    #messages {
      list-style-type: none;
      margin: 0;
      padding: 1rem;
      overflow-y: scroll;
      height: calc(100vh - 7rem);
      background-color: #000; /* Set chat background color to black */
    }

    #messages > li {
      padding: 1rem;
      border-radius: 5px;
      margin-bottom: 0.5rem;
      background-color: #333; /* Set individual message background color to dark gray */
    }

    #messages .meta {
      font-size: 0.8rem;
      color: #777;
    }

    #messages .typing-indicator {
      color: #aaa;
      font-style: italic;
    }
  </style>
</head>
<body>

  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-8 offset-lg-2">
        <div class="card mt-4">
          <div class="card-header bg-dark text-white">Chat</div>
          <ul id="messages" class="list-group"></ul>
          <div class="card-footer">
            <form id="form" class="form-inline">
              <input id="input" class="form-control" autocomplete="off" placeholder="Type your message..." />
              <button class="btn btn-primary">Send</button>
              <button id="toggle-btn" class="btn btn-danger ml-2">Disconnect</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
  <script>
    const socket = io();
    const typingTimeout = 500; // milliseconds

    const toggleButton = document.getElementById('toggle-btn');
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messages = document.getElementById('messages');
    let typingIndicatorTimeout;

    toggleButton.addEventListener('click', (e) => {
      e.preventDefault();
      if (socket.connected) {
        toggleButton.innerText = 'Connect';
        socket.disconnect();
      } else {
        toggleButton.innerText = 'Disconnect';
        socket.connect();
      }
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (input.value) {
        socket.emit('chat message', input.value);
        input.value = '';
      }
    });

    input.addEventListener('input', () => {
      clearTimeout(typingIndicatorTimeout);
      socket.emit('typing');
      typingIndicatorTimeout = setTimeout(() => {
        socket.emit('stop typing');
      }, typingTimeout);
    });

    socket.on('chat message', (msg) => {
      appendMessage(msg);
    });

    socket.on('typing', (user) => {
      showTypingIndicator(user);
    });

    socket.on('stop typing', () => {
      hideTypingIndicator();
    });

    function appendMessage(msg) {
      const item = document.createElement('li');
      const meta = document.createElement('div');
      meta.classList.add('meta');
      meta.textContent = getFormattedTime();
      item.innerHTML = `<i class="bi bi-person"></i> ${msg}`;
      item.appendChild(meta);
      messages.appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    }

    function showTypingIndicator(user) {
      const indicator = document.createElement('li');
      indicator.classList.add('typing-indicator');
      indicator.innerHTML = `<i class="bi bi-chat-dots"></i> ${user} is typing...`;
      messages.appendChild(indicator);
      window.scrollTo(0, document.body.scrollHeight);
    }

    function hideTypingIndicator() {
      const indicators = document.querySelectorAll('.typing-indicator');
      indicators.forEach((indicator) => indicator.remove());
    }

    function getFormattedTime() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      return `${hours}:${minutes}`;
    }
  </script>
</body>
</html>
